# Bomlok

The idea of this library is to reduce the need for reflection when getting values from a struct by utilizing code generation.

The name is heavily inspired by the lombok library that has been written for java to reduce the need for getters and setters,
however this library is more or less the other way around, but to simplify the process for the most common usage of reflection.

## Motivation

There is no getting around, reflection is relatively slow. To speed it up some people have decided to write reflection libraries that utilize the `unsafe` package. However i believe that is the wrong approach to a solution that
can lead to dangerous consequences. Generated code is faster and should have no meaningful overhead compared to other forms of reflection.

## Installation

Install the code generator:

```bash
go install github.com/anton7r/bomlok/cmd/bomlok@latest
```

Or add the library to your project:

```bash
go get github.com/anton7r/bomlok
```

## The Bomlok Interface

```go
type Bomlok interface {
    Bomlok_GetValue(string) any
    Bomlok_Fields() []string
}
```

- `Bomlok_GetValue(field string) any` - Returns the value of a struct field by name
- `Bomlok_Fields() []string` - Returns a list of all field names in the struct

## Code Generator Usage

The `bomlok` command-line tool generates implementations of the Bomlok interface for all structs in your Go code.

### Basic Usage

```bash
# Generate for current directory
bomlok

# Generate for specific directories
bomlok -include=./models -include=./entities

# Exclude directories
bomlok -include=. -exclude=vendor -exclude=.git

# Verbose output
bomlok -verbose
```

### Options

- `-include <directory>` - Directory to include (can be specified multiple times, default: current directory)
- `-exclude <directory>` - Directory to exclude (can be specified multiple times)
- `-verbose` - Enable verbose output

### Integration with go generate

Add a `//go:generate` directive to your package:

```go
//go:generate bomlok -include=.

package mypackage
```

Then run:

```bash
go generate ./...
```

## Example

Given `models.go`:

```go
package example

type Person struct {
    FirstName string
    LastName  string
    Age       int
    Email     string
}
```

Run the generator:

```bash
bomlok -include=.
```

This generates `models_bomlok.go`:

```go
// Code generated by bomlok. DO NOT EDIT.

package example

func (s *Person) Bomlok_GetValue(field string) any {
    switch field {
    case "FirstName":
        return s.FirstName
    case "LastName":
        return s.LastName
    case "Age":
        return s.Age
    case "Email":
        return s.Email
    default:
        return nil
    }
}

func (s *Person) Bomlok_Fields() []string {
    return []string{
        "FirstName",
        "LastName",
        "Age",
        "Email",
    }
}
```

Now you can use it:

```go
person := &Person{
    FirstName: "John",
    LastName:  "Doe",
    Age:       30,
    Email:     "john@example.com",
}

// Get all fields
fields := person.Bomlok_Fields()
fmt.Println(fields) // [FirstName LastName Age Email]

// Get field values dynamically
name := person.Bomlok_GetValue("FirstName")
fmt.Println(name) // John

age := person.Bomlok_GetValue("Age")
fmt.Println(age) // 30
```

## How It Works

1. The generator recursively walks through specified directories
2. Parses each `.go` file (excluding test and generated files)
3. Finds all struct definitions using Go's AST parser
4. Generates `*_bomlok.go` files with interface implementations
5. Each struct receives optimized getter methods without reflection

## Benefits

- **Performance**: No reflection overhead at runtime, Bomlok is approximately 200-260x faster than reflection for getting field values, with zero memory allocations.
- **Type Safety**: Generated code is type-checked at compile time
- **Zero Dependencies**: Generated code has no external dependencies
- **Simple**: Easy to integrate into existing projects
- **Flexible**: Command-line options for include/exclude patterns

## See Also

- [Command-line tool documentation](./cmd/bomlok/README.md)
- [Example usage](./demo/main.go)
