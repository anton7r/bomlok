# Bomlok Project Structure

This document provides an overview of the bomlok project structure and components.

## Project Layout

```
bomlok/
├── bomlok.go                    # Core Bomlok interface definition
├── go.mod                       # Go module definition
├── README.md                    # Main project documentation
├── LICENSE                      # Project license
├── .gitignore                   # Git ignore patterns
│
├── cmd/
│   └── bomlok/
│       ├── main.go             # Code generator CLI tool
│       └── README.md           # CLI documentation
│
├── example/
│   ├── models.go               # Example struct definitions
│   ├── models_bomlok.go        # Generated code (by tool)
│   └── models_test.go          # Tests for generated code
│
├── demo/
│   └── main.go                 # Demo application showing usage
│
└── testdata/
    └── test.go                 # Test fixtures
```

## Components

### Core Library (`bomlok.go`)

Defines the `Bomlok` interface with two methods:
- `Bomlok_GetValue(field string) any` - Get field value by name
- `Bomlok_Fields() []string` - Get all field names

### Code Generator (`cmd/bomlok/main.go`)

A command-line tool that:
1. Recursively walks directory trees
2. Parses Go source files using `go/ast` and `go/parser`
3. Identifies struct definitions
4. Generates `*_bomlok.go` files with interface implementations

**Features:**
- Multiple include directories (`-include`)
- Multiple exclude directories (`-exclude`)
- Verbose output mode (`-verbose`)
- Skips test files and previously generated files
- Glob pattern support for directory exclusion

### Example Package (`example/`)

Demonstrates the generator with three sample structs:
- `Person` - Basic struct with string and int fields
- `Address` - Struct with multiple string fields
- `Company` - Struct with mixed field types (string, int, float64, bool)

Includes comprehensive tests in `models_test.go`.

### Demo Application (`demo/main.go`)

Shows practical usage of generated Bomlok implementations:
- Creating struct instances
- Using `Bomlok_Fields()` to enumerate fields
- Using `Bomlok_GetValue()` to access field values dynamically

## Generated Code Format

For each struct, the generator creates:

```go
// Code generated by bomlok. DO NOT EDIT.

package <original-package>

func (s *<StructName>) Bomlok_GetValue(field string) any {
    switch field {
    case "<FieldName>":
        return s.<FieldName>
    // ... more cases
    default:
        return nil
    }
}

func (s *<StructName>) Bomlok_Fields() []string {
    return []string{
        "<FieldName>",
        // ... more fields
    }
}
```

## Build & Run

### Build the Generator

```bash
go build -o bomlok ./cmd/bomlok
```

### Run the Generator

```bash
# Current directory
./bomlok

# Specific directories
./bomlok -include=./models -include=./entities

# With exclusions
./bomlok -include=. -exclude=vendor -exclude=testdata

# Verbose mode
./bomlok -include=. -verbose
```

### Run Tests

```bash
# Test example package
go test ./example/

# Test with coverage
go test -cover ./example/

# Run all tests
go test ./...
```

### Run Demo

```bash
go run ./demo/
```

## Integration Patterns

### As go generate

Add to your package:

```go
//go:generate bomlok -include=.
package mypackage
```

Then run:
```bash
go generate ./...
```

### As a Build Step

Add to your build script or Makefile:

```makefile
generate:
	bomlok -include=./internal -exclude=vendor
```

### In CI/CD

```yaml
- name: Generate Bomlok code
  run: |
    go install github.com/anton7r/bomlok/cmd/bomlok@latest
    bomlok -include=. -exclude=vendor
```

## Performance Considerations

The generated code:
- Uses simple switch statements (O(1) average case)
- No reflection overhead at runtime
- Type-safe and compiler-optimized
- Zero external dependencies

## Supported Field Types

The generator handles:
- Basic types (int, string, bool, float64, etc.)
- Pointers (`*Type`)
- Slices (`[]Type`)
- Maps (`map[KeyType]ValueType`)
- Qualified types (`package.Type`)
- Interfaces

## Limitations

- Only exported struct fields are accessible via Bomlok interface
- Embedded fields are not currently supported
- Anonymous structs are skipped
- Private fields (lowercase) are included but may not be accessible from other packages

## Future Enhancements

Potential improvements:
- Support for struct tags to customize behavior
- Option to generate pointer vs value receivers
- Support for embedded fields
- Custom naming patterns for generated files
- JSON/XML tag integration
- Performance benchmarking tools
